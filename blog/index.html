
<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="Ramblings by a developer">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Include Brain</title>
    <link rel="shortcut icon" href='http://includebrain.com/img/favicon.png'>
    <link rel="alternate" type="application/rss+xml" title="Include Brain" href='http://includebrain.com/blog/rss.xml' />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href='http://includebrain.com/css/FSharp.Formatting/styles/style.css'>
    <link rel="stylesheet" href='http://includebrain.com/css/firm.css'>
    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <script>window.html5 || document.write('<script src="js/vendor/html5shiv.js"><\/script>')</script>
    <![endif]-->
</head>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href='http://includebrain.com/'>Include Brain</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class=""><a href='http://includebrain.com/blog/about'>About</a></li>
                    <li class=""><a href='http://includebrain.com/blog/archive'>Archive</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div id="topsection" class="jumbotron">
        <div class="container">
            <h1><a href='http://includebrain.com/'>Include Brain</a></h1>
            <p>Ramblings by a developer</p>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div id="main-panel" class="col-md-8">
                




<div class="post">
    
    <h1 class="post-title"><a href='http://includebrain.com/blog/post/url-rewrite-for-asp-net-web-api-spa/'>Url rewrite for ASP.NET Web API SPA</a></h1>
    <small>2015-11-23 22:28:00</small>
    <div class="post-content"><img class="img-responsive" alt="HTML CSS JS" src="/blog/post/url-rewrite-for-asp-net-web-api-spa/img/html-css-js.png"/>

<p>I just wanted to share this thing I had to search a while for.</p>

<p>When making a SPA (Single Page Application) I divided my website into two parts: One part Asp.net web api and one part static html/js/css, as one usually does. However, I also wanted to use the html5 history api with no hash in the url. For example, imagine that <code>http://example.com/</code> returns a list of users, and when clicking on "Dolly Parton" we change the url to <code>http://example.com/users/dolly-parton</code>, an ajax request is made to a back-end api, which returns a JSON-string, which is rendered in the view. Now imagine that we bookmark that url and then open it later, what will happen? Well, the server will receive a request for that path and e.g. try to find a directory /users/dolly-parton with an index.html in it, none is found so 404 you get.</p>

<p>In other words, we need to make sure that most incoming paths are routed to our spa index.html so that <em>it</em> can handle the path and show the right view. We also need to still be able to call our back-end api, and we also need to be able to fetch our static html-templates, js- and css-files. In my case I have my api at <code>/api</code> and all my static files in a directory <code>/public</code>.</p>

<p>I'm sure there are many ways to do this, but since I'm running an Asp.net Web API project I opted for IIS configuration in my web.config. Specifically this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="o">&lt;</span><span class="i">system</span><span class="o">.</span><span class="i">webServer</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">rewrite</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">rules</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="i">rule</span> <span class="i">name</span><span class="o">=</span><span class="s">&quot;RewriteUnknownToIndex&quot;</span> <span class="i">patternSyntax</span><span class="o">=</span><span class="s">&quot;ECMAScript&quot;</span> <span class="i">stopProcessing</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="k">match</span> <span class="i">url</span><span class="o">=</span><span class="s">&quot;^(public|api)/.*&quot;</span> <span class="i">negate</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="i">action</span> <span class="k">type</span><span class="o">=</span><span class="s">&quot;Rewrite&quot;</span> <span class="i">url</span><span class="o">=</span><span class="s">&quot;/public/index.html&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;/</span><span class="i">rule</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="i">rules</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="i">rewrite</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">system</span><span class="o">.</span><span class="i">webServer</span><span class="o">&gt;</span>
</pre>
</td>
</tr>
</table>

<p>This rule simply says: If the path does <em>not</em> start with "public" or "api", then return <code>/public/index.html</code>.</p>

<p>It is an OWIN application, so there are probably some neat way to do this using the <code>Owin.IAppBuilder</code> (comments are welcome), but right now I decided to go with the IIS config, mainly for the simplicity.</p>


</div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'includebrain'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            <div id="right-panel" class="col-md-4">
                <div id="tag-cloud">
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=asp.net'>asp.net</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=web%20api'>web api</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=spa'>spa</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=url'>url</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=iis'>iis</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=web.config'>web.config</a>
                        <a class="tag tag-unselected" data-postcount="2" href='http://includebrain.com/blog/archive?tag=blog'>blog</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=static'>static</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=generator'>generator</a>
                        <a class="tag tag-unselected" data-postcount="4" href='http://includebrain.com/blog/archive?tag=f%23'>f#</a>
                        <a class="tag tag-unselected" data-postcount="3" href='http://includebrain.com/blog/archive?tag=learning'>learning</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=stemming'>stemming</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=java'>java</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=functional-programming'>functional-programming</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=c%23'>c#</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=configuration'>configuration</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=code'>code</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=log4net'>log4net</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=logging'>logging</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=xml'>xml</a>
                        <a class="tag tag-unselected" data-postcount="1" href='http://includebrain.com/blog/archive?tag=hello'>hello</a>
                </div>
                <div id="latest-posts">
                    <h3>Latest posts</h3>
                        <h4>
                            <a href='http://includebrain.com/blog/post/url-rewrite-for-asp-net-web-api-spa/'>Url rewrite for ASP.NET Web API SPA</a>
                            <br/>
                            <small>2015-11-23 22:28:00</small>
                        </h4>
                        <h4>
                            <a href='http://includebrain.com/blog/post/firm-a-blog-aware-static-site-generator-in-fsharp/'>Firm, a blog-aware, static site generator in F#</a>
                            <br/>
                            <small>2015-05-30 20:36:00</small>
                        </h4>
                        <h4>
                            <a href='http://includebrain.com/blog/post/another-porter-stemmer-in-fsharp/'>Another Porter Stemmer in F#</a>
                            <br/>
                            <small>2014-04-20 22:30:47</small>
                        </h4>
                        <h4>
                            <a href='http://includebrain.com/blog/post/helping-bitizens-to-better-jobs-in-tiny-tower-using-fsharp/'>Helping Bitizens to Better Jobs in Tiny Tower Using F#</a>
                            <br/>
                            <small>2014-03-17 11:27:23</small>
                        </h4>
                        <h4>
                            <a href='http://includebrain.com/blog/post/learning-fsharp/'>Learning F#</a>
                            <br/>
                            <small>2014-01-04 19:16:39</small>
                        </h4>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="row">
            <div class="col-md-4">
                <p>This site is generated with <a href="https://github.com/andagr/Firm">Firm</a> and hosted on <a href="https://github.com/andagr/Firm">Github</a>.</p>
                <p>By <a href="https://github.com/andagr">Andreas Ågren</a>.</p>
            </div>
        </div>
    </footer>
    
    <a href="https://github.com/andagr/Firm">
        <img style="position: absolute; top: 50px; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
    </a>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script type="text/javascript" src='http://includebrain.com/js/ie10-viewport-bug-workaround.js'></script>
    <script type="text/javascript" src='http://includebrain.com/js/FSharp.Formatting/tips.js'></script>
    <script type="text/javascript" src='http://includebrain.com/js/netext.js'></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-63590454-1', 'auto');
        ga('send', 'pageview');
    </script>
</body>
</html>
